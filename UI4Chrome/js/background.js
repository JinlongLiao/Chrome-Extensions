function getPreview(a){return new Promise((b)=>{const c=new Image;return a?void(c.src='https://mini.s-shot.ru/1366x890/400/jpeg/?'+a,c.onload=()=>{const a=document.createElement('canvas');a.width=c.width,a.height=c.height;const d=a.getContext('2d');d.drawImage(c,0,0,a.width,a.height);const e=a.toDataURL('image/jpeg');b(e)},c.onerror=()=>b(null)):b(null)})}function initBookmarks(){chrome.topSites.get((a)=>{let b=a.filter((a)=>'chrome'!==a.url.slice(0,6)&&!a.url.includes('localhost')).slice(0,10).map((a,b)=>({id:b,url:a.url,title:a.title||'',img:''}));chrome.storage.local.set({bookmarks:b});const c=b.map((a)=>getPreview(a.url));Promise.all(c).then((a)=>{b=b.map((c,b)=>(c.img=a[b],c)),chrome.storage.local.set({bookmarks:b}),chrome.runtime.sendMessage({action:'reload-storage'})})})}chrome.browserAction.onClicked.addListener(()=>chrome.tabs.create({})),chrome.runtime.onInstalled.addListener((a)=>{'install'===a.reason&&initBookmarks()}),chrome.contextMenus.removeAll(()=>{chrome.contextMenus.create({id:'newtab_utilsExtDownloadMenuItem',title:'Pin '+chrome.i18n.getMessage('name'),contexts:['page','link'],onclick:function(a,b){if(a.pageUrl.includes('chrome-extension')||a.pageUrl.includes('chrome://'))return!1;if(a.linkUrl){const b=a.linkUrl,c=encodeURIComponent(b);chrome.tabs.create({url:'/newtab.html?url='+c,active:!0})}else if(a.pageUrl){const c=a.pageUrl,d=b.title,e=encodeURIComponent(c);chrome.tabs.create({url:'/newtab.html?url='+e+'&title='+d,active:!0})}}})}),chrome.runtime.onMessage.addListener((a)=>{if('create-window'===a.action){const b=a.width||1e3,c=a.height||800;chrome.windows.create({type:'popup',url:a.url,width:b,height:c,left:screen.width/2-b/2})}});